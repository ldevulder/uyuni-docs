[[maintenance-windows]]
= Maintenance Windows

The maintenance windows feature in {productname} allows you to schedule actions to occur during a scheduled maintenance window period.
When you have assigned a maintenance window to a client, the client is prevented from executing some actions outside of the specified period.

Maintenance windows require both a calendar, and a schedule.
The calendar defines the date and time of your maintenance window events, including recurring events, and must be in [path]``ical`` format.
The schedule uses the events defined in the calendar to create the maintenance windows.
You must create an [path]``ical`` file for upload, or link to an [path]``ical`` file to create the calendar, before you can create the schedule.

When you have created the schedule, you can assign it to clients that are registered to the {productname} Server.
Clients that have a maintenance schedule assigned cannot run restricted actions outside of maintenance windows.

Restricted actions significantly modify the client, and could potentially cause the client to stop running.
Some examples of restricted actions are:

* Package installation
* Client upgrade
* Service pack migration
* Highstate application (for Salt clients)

Unrestricted actions are minor actions that are considered safe and are unlikely to cause problems on the client.
Some examples of unrestricted actions are:

* Package profile update
* Hardware refresh
* Subscribing to software channels


Before you begin, you must create an [path]``ical`` file for upload, or link to an [path]``ical`` file to create the calendar.
You can create [path]``ical`` files in your preferred calendaring tool, such as KOrganizer.



.Procedure: Uploading a New MaintenanceÂ Calendar
. In the {productname} {webui}, navigate to menu:Schedule[Maintenance Windows > Calendar], and click btn:[Create].
. In the [guimenu]``Calendar Name`` section, type a name for your calendar.
. Either provide a URL to your [path]``ical`` file, or upload the file directly.
. Click btn:[Create Schedule] to save your calendar.
// Well, that;s confusing :\ -- LKB 2020-07-21



.Procedure: Creating a New Schedule
. In the {productname} {webui}, navigate to menu:Schedule[Maintenance Windows > Calendar], and click btn:[Create].
. In the [guimenu]``Schedule Name`` section, type a name for your schedule.
. OPTIONAL: If your [path]``ical`` file contains events that apply to more than one schedule, check [guimenu]``Multi``.
. Select the calendar to assign to this schedule.
. Click btn:[Update Schedule] to save your schedule.



.Procedure: Assigning a Schedule to a Client
. In the {productname} {webui}, navigate to menu:Systems[Systems List], select the client to be assigned to a schedule, locate the [guimenu]``Properties`` panel and click btn:[Edit These Properties].
Alternatively, you can assign clients through the system set manager by navigating to menu:Systems[System Set Manager] and using the menu:Misc[Maintenance Windows] tab.
. In the [guimenu]``Edit System Details`` page, locate the [guimenu]``Maintenance Schedule`` field, and select the name of the schedule to be assigned.
. Click btn:[Update Properties] to assign the maintenance schedule.

[NOTE]
====
When you assign a new maintenance schedule to a client, it is possible that the client might already have some restricted actions scheduled, and that these might now conflict with the new maintenance window.
If this occurs, the {webui} will display an error and you will not be able to assign the schedule to the client.
To resolve this, check the btn:[Cancel affected actions] option when you assign the schedule.
This will delete any previously scheduled actions that conflict with the new maintenance schedule.
====



.Procedure: Performing a Package Upgrade
. In the {productname} {webui}, navigate to menu:Systems[System List], select the client you want to upgrade, and go to the menu:Software[Packages > Upgrade] tab.
. Select the package to upgrade from the list, and click btn:[Upgrade Package].
. In the [guimenu]``Maintenance Window`` field, select which maintenance window the client should use to perform the upgrade.



== Create Multiple Maintenance Schedules

When you create a calendar, it contains a number of events, which can be either one-time events, or recurring events.
Each event contains a ``summary`` field.
If you want to create multiple maintenance windows for one calendar, you can specify events for each using the ``summary`` field.

For example, you might like to create a schedule for production servers, and a different schedule for testing servers.
In this case, you would specify ``SUMMARY: Production Servers`` on events for the production servers, and ``SUMMARY: Testing Servers`` on events for the testing servers.

image::maint_windows_multi.png[scaledwidth=80%]

There are two types of schedule: single, or multi.
If your calendar contains events that apply to more than one schedule, then you must select ``multi``, and ensure you name the schedule according to the ``summary`` field you used in the calendar file.



.Procedure: Creating Multiple Schedules
. In the {productname} {webui}, navigate to menu:Schedule[Maintenance Windows > Calendar], and click btn:[Create].
. In the [guimenu]``Schedule Name`` section, type the name for your schedule.
Ensure it matches the ``summary`` field of the calendar.
. Check the [guimenu]``Multi`` option.
. Select the calendar to assign to this schedule.
// Create another schedule with the other summary line? --LKB 2020-07-22
. Click btn:[Update Schedule] to save your schedule.
